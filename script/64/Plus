#!/bin/bash
clear
apt-get install lolcat -y &>/dev/null
apt-get install figlet -y &>/dev/null
apt-get install curl -y &>/dev/null
apt install git -y &>/dev/null
apt install figlet boxes -y &>/dev/null
cd $HOME

# Verifica se o usuário é root
[[ "$(whoami)" != "root" ]] && {
    echo -e "\033[1;33m[\033[1;31mErro\033[1;33m] \033[1;37m- \033[1;33mVocê precisa executar como root\033[0m"
    rm $HOME/Plus >/dev/null 2>&1
    exit 0
}

# Função de barra de progresso
fun_bar () {
    comando[0]="$1"
    comando[1]="$2"
    (
        [[ -e $HOME/fim ]] && rm $HOME/fim
        ${comando[0]} -y > /dev/null 2>&1
        ${comando[1]} -y > /dev/null 2>&1
        touch $HOME/fim
    ) > /dev/null 2>&1 &
    tput civis
    echo -ne "  \033[1;37mAGUARDE \033[1;37m- \033[1;37m["
    while true; do
        for((i=0; i<18; i++)); do
            echo -ne "\033[1;31m#"
            sleep 0.1s
        done
        [[ -e $HOME/fim ]] && rm $HOME/fim && break
        echo -e "\033[1;37m]"
        tput cuu1
        tput dl1
        echo -ne "  \033[1;37mAGUARDE \033[1;37m- \033[1;37m["
    done
    echo -e "\033[1;37m]\033[1;37m -\033[1;32m OK !\033[1;37m"
    tput cnorm
}

# Instalação das versões do Python
instala_python () {
    # Instala Python2 e Python3.6 ao Python3.11
    apt-get install -y python python2 python3.6 python3.7 python3.8 python3.9 python3.10 python3.11

    # Cria alternativas para Python3
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.6 1
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.7 2
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 3
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.9 4
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 5
    update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 6

    # Instala pip
    apt install -y python3-pip

    # Instala socat
    apt install -y socat

    # Seta Python3 padrão para 3.6
    update-alternatives --set python3 /usr/bin/python3.6
}

# Verifica a chave
verif_key () {
    chmod +x $_Ink/list > /dev/null 2>&1
    [[ ! -e "$_Ink/list" ]] && {
        echo -e "\n\033[1;31mKEY INVÁLIDA!\033[0m"
        rm -rf $HOME/Plus > /dev/null 2>&1
        tput reset
        exit 1
    }
}

tput reset
echo -e "\033[0;34m┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\033[0m"
echo -e "\033[0;34m┃\E[41;1;37m             ⇱ SCRIPT SSHPLUS PRO ⇲              \E[0m\033[0;34m┃"
echo -e "\033[0;34m┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\033[0m"
echo ""          
echo -e "             \033[1;31mATENCAO! \033[1;37mESSE SCRIPT IRA !\033[0m"
echo ""
echo -e "\033[1;31m• \033[1;37mINSTALAR UM CONJUNTO DE SCRIPTS COMO FERRAMENTAS\033[0m"
echo -e "\033[1;37m  PARA O GERENCIAMENTO DE REDE, SISTEMA E USUARIOS\033[0m"
echo ""
echo -e "\033[1;32m• \033[1;32mDICA! \033[1;37mULTILIZE O TEMA DARK EM SEU TERMINAL PARA\033[0m"
echo -e "\033[1;37m  UMA MELHOR EXPERIÊNCIA E VISUALIZACAO DO MESMO!\033[0m"
echo ""   
echo -e "\033[0;34m┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\033[0m"
echo -e "\033[0;34m┃\033[1;37m               by:@TURBONET2023                  \E[0m\033[0;34m┃"
echo -e "\033[0;34m┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\033[0m"           
echo ""
#-----------------------------------------------------------------------------------------------------------------
echo -e "\n\033[1;36mVERIFICANDO LINK... \033[0m"
rm $_Ink/list > /dev/null 2>&1
wget -P $_Ink https://raw.githubusercontent.com/PhoenixxZ2023/PLUS/main/Install/list >/dev/null 2>&1
verif_key
sleep 3s

# Instala e configura pacotes
echo -e "    \033[1;37mINSTALANDO PACOTES NECESSÁRIOS...\033[0m"
echo ""
fun_bar "apt-get update" "apt-get install bc screen nano unzip lsof net-tools dos2unix nload jq"
echo ""
apt-get install curl -y &>/dev/null
apt-get install firewalld -y &>/dev/null
systemctl start firewalld
systemctl enable firewalld
firewall-cmd --zone=public --permanent --add-port=80/tcp
firewall-cmd --zone=public --permanent --add-port=8989/tcp
firewall-cmd --zone=public --permanent --add-port=5454/tcp
firewall-cmd --zone=public --permanent --add-port=8888/tcp
firewall-cmd --zone=public --permanent --add-port=8080/tcp
firewall-cmd --zone=public --permanent --add-port=7300/udp
firewall-cmd --zone=public --permanent --add-port=443/tcp
firewall-cmd --reload

# Instala Python e cria alternativas
instala_python

# Finaliza instalação
tput reset
echo ""
echo -e "\033[1;33m • \033[1;32mINSTALACAO CONCLUIDa \033[1;33m • \033[0m"
echo ""
echo "clear" >> /root/.bashrc
echo 'figlet -k SSH-PLUS | lolcat' >> /root/.bashrc
echo 'echo -e " NOME DO SERVIDOR : $HOSTNAME"' >> /root/.bashrc
echo 'echo -e " SERVIDOR LIGADO À : $(uptime -p)"' >> /root/.bashrc
echo 'echo -e " DATA : $(date +'%d-%m-%y')"' >> /root/.bashrc
echo 'echo -e " HORA : $(date +'%T')"' >> /root/.bashrc
echo 'echo -e " (TELEGRAM)--@TURBONET2023"' >> /root/.bashrc
echo 'echo -e "\033[1;31m DIGITE ( menu ) PARA ENTRAR\033[0m"' >> /root/.bashrc
echo 'echo -e ""' >> /root/.bashrc
rm -f $HOME/Plus
cat /dev/null > ~/.bash_history
history -c
